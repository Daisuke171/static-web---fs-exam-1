---
import MainLayout from '../../layout/MainLayout.astro';
import type { GetStaticPaths } from 'astro';
import { slugify } from '../../utils/slugify';

// üö® getStaticPaths obligatorio para rutas din√°micas
export const getStaticPaths: GetStaticPaths = async () => {
  const API_KEY = "26556575658af780cf7d1cdfa28bc314";
  const pageCount = 18;
  const movies = [];

  for (let i = 1; i <= pageCount; i++) {
    const response = await fetch(`https://api.themoviedb.org/3/movie/popular?api_key=${API_KEY}&language=es-ES&page=${i}`);
    const data = await response.json();
    movies.push(...data.results);
  }

  return movies.map(movie => ({
    params: { slug: `${slugify(movie.title)}-${movie.id}` },
    props: { movie },
  }));
};

const { slug } = Astro.params;
const id = String(slug).split('-').pop();
const API_KEY = "26556575658af780cf7d1cdfa28bc314";
const response = await fetch(`https://api.themoviedb.org/3/movie/${id}?api_key=${API_KEY}&language=es-ES`);
const movie = await response.json();
---

<MainLayout title={movie.title}>
  <header class="movie-header">
    <h1>{movie.title}</h1>
    <p>{movie.overview}</p>
    <img src={`https://image.tmdb.org/t/p/w500${movie.poster_path}`} alt={movie.title} />
    <p>‚≠ê {movie.vote_average}</p>
    <p>Release Date: {movie.release_date}</p>
  </header>
</MainLayout>

<style>
.movie-header {
  text-align: center;
  padding: 2rem;
  background-color: var(--color-dark);
  color: var(--color-light);
}
.movie-header img {
  width: 300px;
  border-radius: 10px;
  margin-top: 1rem;
}
</style>